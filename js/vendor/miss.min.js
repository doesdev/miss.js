/*
 *  Miss.js - v1.0.0
 *  Make it simple stupid. Web app walkthroughs for maximum user conversion.
 *  https://github.com/musocrat/miss
 *
 *  Made by Andrew Carpenter
 *  Under MIT License
 */
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};!function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this;return k=function(a){var d,e,f,g,i,l,m,n,o,q,r,s,t;if(k.missies=k.missies||[],k.global||k.settings(a.settings||null),m=function(){return{order:"series",background_color:"#f5f5f5",titlebar_color:"#939393",font_color:"#000"}},a.elements){k.off(),f=0,s=a.elements;for(g in s)for(o=s[g],d=m(),l=h(h(d,o),k.global),t=b.querySelectorAll.call(b,g),q=0,r=t.length;r>q;q++)e=t[q],n=l.title||e.dataset.missTitle||null,i=j(l.msg)||j(e.dataset.missMsg)||null,(n||i)&&k.missies.push(new c(e,f+=1,l,n,i));return p(),k.on(),k.missies[0].on()}},c=function(){function c(b,c,d,e,f){this.off=a(this.off,this),this.on=a(this.on,this),this.resize=a(this.resize,this),this.highlight=a(this.highlight,this),this.boxSizing=a(this.boxSizing,this),this.buildBox=a(this.buildBox,this),this.el=b,this.order=parseInt(this.el.dataset.missOrder,10)||parseInt(d.order,10)||100+c,this.opts=d,this.title=e,this.msg=f,this.index=c,this.buildBox()}return c.prototype.buildBox=function(){var a,c,d,e,g,h,i,j;return a=b.createElement("div"),a.id="miss_"+this.order,a.className="miss-box popover",a.style.position="fixed",j=b.createElement("div"),j.className="miss-titlebar popover-title",c='<span style="float:right;cursor:pointer;" onclick="miss.off()"               class="close" aria-hidden="true">&times;</span>',j.innerHTML=this.title+c,d=b.createElement("div"),d.className="miss-msg popover-content",d.innerHTML=this.msg,e=b.createElement("div"),e.className="miss-nav",g='<div class="btn-group">                      <button class="btn btn-default" onclick="miss.previous();">prev</button>                      <button class="btn btn-default" onclick="miss.next();">next</button></div>',h='<p class="miss-step-num pull-right"></p>',e.innerHTML=g+h,k.global.theme||(i=f(this.opts.titlebar_color),a.style.backgroundColor=this.opts.background_color,a.style.borderRadius="3px",a.style.border="1px solid rgba("+i.red+", "+i.green+", "+i.blue+", 0.6)",j.style.backgroundColor=this.opts.titlebar_color,j.style.borderTopLeftRadius="3px",j.style.borderTopRightRadius="3px",j.style.padding="8px",e.style.textAlign="center",d.style.padding="8px"),a.appendChild(j),d.appendChild(e),a.appendChild(d),o(a,!1),k.bd.appendChild(a),this.box=a,this.boxSizing()},c.prototype.boxSizing=function(){var a,b,c,d;return c=g(this.el),a=k.bd.miss_visible||null,b=this.box.miss_visible||null,a||(k.bd.style.visibility="hidden",k.on()),b||(this.box.style.visibility="hidden",o(this.box,!0)),this.box.style.maxWidth="30%",this.box.style.maxHeight="60%",d=i(c,this.box.offsetHeight,this.box.offsetWidth),this.box.style.top=""+d.x+"px",this.box.style.left=""+d.y+"px",a||(k.bd.style.visibility="",k.off()),b?void 0:(this.box.style.visibility="",o(this.box,!1))},c.prototype.highlight=function(){var a,c,d,e;return a=g(this.el),e=this.opts.highlight?this.opts.highlight_width:0,d=b.getElementById("miss_hl_"+this.index)||b.createElement("div"),d.id="miss_hl_"+this.index,d.style.position="fixed",d.style.top=""+(a.top-e)+"px",d.style.left=""+(a.left-e)+"px",d.style.width=""+(a.width+e)+"px",d.style.height=""+(a.height+e)+"px",this.opts.highlight&&(d.style.border=""+e+"px solid "+this.opts.highlight_color),k.bd.appendChild(d),c=b.getElementById("miss_bd_canvas").getContext("2d"),c.save(),c.globalAlpha=1,c.globalCompositeOperation="destination-out",c.beginPath(),c.fillRect(a.left,a.top,a.width+e,a.height+e),c.fill(),c.restore()},c.prototype.resize=function(){return this.boxSizing(),e(),this.highlight()},c.prototype.on=function(){return this.highlight(),o(this.box,!0),l(this.box)},c.prototype.off=function(){var a;return a=b.getElementById("miss_hl_"+this.index),a&&a.parentNode.removeChild(a),e(),o(this.box,!1)},c}(),o=function(a,b){return a.style.cssText=a.style.cssText+=b?"display:block !important;":"display:none !important;",a.miss_visible=b},h=function(a,b){var c;for(c in b)a[c]=b[c];return a},f=function(a){return{red:parseInt(m(a).substring(0,2),16),green:parseInt(m(a).substring(2,4),16),blue:parseInt(m(a).substring(4,6),16)}},m=function(a){return a="#"===a.charAt(0)?a.split("#")[1]:a,3===a.length?a+a:a},p=function(){return k.missies.sort(function(a,b){return a.order-b.order})},g=function(a){var b,c;return c=a.getBoundingClientRect(),b=k.global.highlight?k.global.highlight_width:0,{top:c.top-b,right:c.right+b,bottom:c.bottom+b,left:c.left-b,width:c.width||c.right-c.left,height:c.height||c.bottom-c.top}},q=function(){var a;return(a=b.getElementById("miss-size-test"))||(a=b.createElement("div"),a.id="miss-size-test",a.style.cssText="position: fixed;top: 0;left: 0;bottom: 0;right: 0; visibility: hidden;",b.body.appendChild(a)),{height:a.offsetHeight,width:a.offsetWidth}},i=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,r,s,t,u,v,w,x,y;d=[],e=[],g={x:q().height/2,y:q().width/2},h={x:a.height/2,y:a.width/2},f={x:b/2,y:c/2},j=[{diff:{top:Math.abs(a.top-f.x-g.x),middle:Math.abs(a.top-g.x),bottom:Math.abs(a.top+f.x-g.x)},val:{top:a.top-b,middle:a.top-f.x,bottom:a.top},position:"top"},{diff:{top:Math.abs(a.top+h.x-f.x-g.x),middle:Math.abs(a.top+h.x-g.x),bottom:Math.abs(a.top+h.x+f.x-g.x)},val:{top:a.top+h.x-b,middle:a.top+h.x-f.x,bottom:a.top+h.x},position:"middle"},{diff:{top:Math.abs(a.bottom-f.x-g.x),middle:Math.abs(a.bottom-g.x),bottom:Math.abs(a.bottom+f.x-g.x)},val:{top:a.bottom-b,middle:a.bottom-f.x,bottom:a.bottom},position:"bottom"}],k=[{diff:{left:Math.abs(a.left-f.y-g.y),middle:Math.abs(a.left-g.y),right:Math.abs(a.left+f.y-g.y)},val:{left:a.left-c,middle:a.left-f.y,right:a.left},position:"left"},{diff:{left:Math.abs(a.left+h.y-f.y-g.y),middle:Math.abs(a.left+h.y-g.y),right:Math.abs(a.left+h.y+f.y-g.y)},val:{left:a.left+h.y-c,middle:a.left+h.y-f.y,right:a.left+h.y},position:"middle"},{diff:{left:Math.abs(a.right-f.y-g.y),middle:Math.abs(a.right-g.y),right:Math.abs(a.right+f.y-g.y)},val:{left:a.right-c,middle:a.right-f.y,right:a.right},position:"right"}];for(i in j){n=j[i],v=n.diff;for(p in v)r=v[p],d.push(r)}for(i in k){n=k[i],w=n.diff;for(t in w)u=w[t],e.push(u)}l=d.sort(function(a,b){return a-b})[0],m=e.sort(function(a,b){return a-b})[0];for(i in j){n=j[i],x=n.diff;for(p in x)r=x[p],r===l&&(o={val:n.val[p],position:""+n.position+"_"+p})}for(i in k){n=k[i],y=n.diff;for(t in y)u=y[t],u===m&&(s={val:n.val[t],position:""+n.position+"_"+t})}return{x:o.val,y:s.val}},d=function(a){var c,d;return(c=b.getElementById("miss_bd"))||(d=k.global,c=b.createElement("div"),c.id="miss_bd",c.style.cssText="position:fixed;z-index:"+d.z_index+";top:0;right:0;bottom:0;left:0;",o(c,!1),b.body.appendChild(c)),k.bd=c,e(),o(c,a)},e=function(){var a,c,d,e,f;return f=q(),e=k.global,(c=b.getElementById("miss_bd_canvas"))||(a=k.bd,c=b.createElement("canvas"),c.id="miss_bd_canvas",a.appendChild(c)),c.width=f.width,c.height=f.height,d=c.getContext("2d"),d.clearRect(0,0,c.width,c.height),d.globalAlpha=e.backdrop_opacity,d.fillStyle="#"+m(e.backdrop_color),d.fillRect(0,0,f.width,f.height)},j=function(a){var c;return/#{(.*?)}/.test(a)?(c=b.querySelector(a.match(/#{(.*?)}/)[1]),o(c,!1),c.innerHTML):a},k.settings=function(a){return k.global=h({theme:null,trigger:null,key_on:null,key_off:null,key_hover:null,backdrop_color:"#000",backdrop_opacity:.5,z_index:2100,welcome_title:null,welcome_msg:null,highlight:!0,highlight_width:3,highlight_color:"#fff"},a)},n=function(){var a;return(a=k.current())?a.missie.resize():void 0},window.onresize=function(){return n()},window.onscroll=function(){return n()},window.onorientationchange=function(){return n()},k.current=function(){var a,b,c,d,e;for(e=k.missies,a=c=0,d=e.length;d>c;a=++c)if(b=e[a],b.box.miss_visible)return{index:a,missie:b}},l=function(a){var b,c;return(b=k.current())?(c=a.getElementsByClassName("miss-step-num")[0],c.innerHTML="<p>"+(b.index+1||1)+"/"+k.missies.length+"</p>"):void 0},k.next=function(){var a;return(a=k.current())?(a.missie.off(),k.missies[a.index+1]?k.missies[a.index+1].on():k.off()):void 0},k.previous=function(){var a;return(a=k.current())?(a.missie.off(),k.missies[a.index-1]?k.missies[a.index-1].on():k.off()):void 0},k.first=function(){return function(){var a;return(a=k.current())?(a.missie.off(),k.missies[0].on()):void 0}},k.last=function(){return function(){var a;return(a=k.current())?(a.missie.off(),k.missies[k.missies.length-1].on()):void 0}},k.on=function(){return d(!0)},k.off=function(){return d(!1)},k.destroy=function(){var a,c;return c=b.getElementById("miss-size-test"),c.parentNode.removeChild(c),a=b.getElementById("miss_bd"),a.parentNode.removeChild(a),delete r.miss},this.miss=k}(document)}).call(this);